import{_ as s,o as a,c as n,Q as e}from"./chunks/framework.53eb7688.js";const l="/bugs/assets/3-1.9b25a8d6.png",b=JSON.parse('{"title":"[vite]: Rollup failed to resolve import xxxxx","description":"","frontmatter":{},"headers":[],"relativePath":"bugs/vite/question/3.md","filePath":"bugs/vite/question/3.md"}'),o={name:"bugs/vite/question/3.md"},p=e(`<h1 id="vite-rollup-failed-to-resolve-import-xxxxx" tabindex="-1">[vite]: Rollup failed to resolve import xxxxx <a class="header-anchor" href="#vite-rollup-failed-to-resolve-import-xxxxx" aria-label="Permalink to &quot;[vite]: Rollup failed to resolve import xxxxx&quot;">​</a></h1><h2 id="问题描述" tabindex="-1">问题描述 <a class="header-anchor" href="#问题描述" aria-label="Permalink to &quot;问题描述&quot;">​</a></h2><p>Jenkins构建vue3项目时报错，log如下：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[error] [</span><span style="color:#79B8FF;">31</span><span style="color:#E1E4E8;">m[vite]: Rollup failed to resolve import </span><span style="color:#9ECBFF;">&quot;@babel/runtime/helpers/asyncToGenerator&quot;</span><span style="color:#E1E4E8;"> from </span><span style="color:#9ECBFF;">&quot;node_modules/.pnpm/@antv+g-webgpu@0.7.2/node_modules/@antv/g-webgpu/es/Kernel.js&quot;</span><span style="color:#E1E4E8;">.</span></span>
<span class="line"><span style="color:#E1E4E8;">This is most likely unintended because it can </span><span style="color:#F97583;">break</span><span style="color:#E1E4E8;"> your application at runtime.</span></span>
<span class="line"><span style="color:#E1E4E8;">If you </span><span style="color:#F97583;">do</span><span style="color:#E1E4E8;"> want to externalize this module explicitly add it to</span></span>
<span class="line"><span style="color:#9ECBFF;">\`</span><span style="color:#B392F0;">build.rollupOptions.external</span><span style="color:#9ECBFF;">\`</span><span style="color:#E1E4E8;">[</span><span style="color:#79B8FF;">39</span><span style="color:#E1E4E8;">m</span></span>
<span class="line"><span style="color:#E1E4E8;">[error] [</span><span style="color:#79B8FF;">31</span><span style="color:#E1E4E8;">merror during build:</span></span>
<span class="line"><span style="color:#E1E4E8;">Error: [vite]: Rollup failed to resolve import </span><span style="color:#9ECBFF;">&quot;@babel/runtime/helpers/asyncToGenerator&quot;</span><span style="color:#E1E4E8;"> from </span><span style="color:#9ECBFF;">&quot;node_modules/.pnpm/@antv+g-webgpu@0.7.2/node_modules/@antv/g-webgpu/es/Kernel.js&quot;</span><span style="color:#E1E4E8;">.</span></span>
<span class="line"><span style="color:#E1E4E8;">This is most likely unintended because it can </span><span style="color:#F97583;">break</span><span style="color:#E1E4E8;"> your application at runtime.</span></span>
<span class="line"><span style="color:#E1E4E8;">If you </span><span style="color:#F97583;">do</span><span style="color:#E1E4E8;"> want to externalize this module explicitly add it to</span></span>
<span class="line"><span style="color:#9ECBFF;">\`</span><span style="color:#B392F0;">build.rollupOptions.external</span><span style="color:#9ECBFF;">\`</span></span>
<span class="line"><span style="color:#E1E4E8;">    at onRollupWarning (file:///data/jenkins/workspace/ever-digitalfactory-develop-app-ppm-e2392d6ad476d483127ce365e5b7bbcd/node_modules/.pnpm/vite@3.2.8_sass@1.70.0+terser@5.27.0/node_modules/vite/dist/node/chunks/dep-f11f7337.js:45909:19)</span></span>
<span class="line"><span style="color:#E1E4E8;">    at onwarn (file:///data/jenkins/workspace/ever-digitalfactory-develop-app-ppm-e2392d6ad476d483127ce365e5b7bbcd/node_modules/.pnpm/vite@3.2.8_sass@1.70.0+terser@5.27.0/node_modules/vite/dist/node/chunks/dep-f11f7337.js:45680:13)</span></span>
<span class="line"><span style="color:#E1E4E8;">    at Object.onwarn (file:///data/jenkins/workspace/ever-digitalfactory-develop-app-ppm-e2392d6ad476d483127ce365e5b7bbcd/node_modules/.pnpm/rollup@2.79.1/node_modules/rollup/dist/es/shared/rollup.js:23263:13)</span></span>
<span class="line"><span style="color:#E1E4E8;">    at ModuleLoader.handleResolveId (file:///data/jenkins/workspace/ever-digitalfactory-develop-app-ppm-e2392d6ad476d483127ce365e5b7bbcd/node_modules/.pnpm/rollup@2.79.1/node_modules/rollup/dist/es/shared/rollup.js:22158:26)</span></span>
<span class="line"><span style="color:#E1E4E8;">    at file:///data/jenkins/workspace/ever-digitalfactory-develop-app-ppm-e2392d6ad476d483127ce365e5b7bbcd/node_modules/.pnpm/rollup@2.79.1/node_modules/rollup/dist/es/shared/rollup.js:22119:26</span></span>
<span class="line"><span style="color:#E1E4E8;">    at async Promise.all (index </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">)[</span><span style="color:#79B8FF;">39</span><span style="color:#E1E4E8;">m</span></span>
<span class="line"><span style="color:#E1E4E8;"> ELIFECYCLE  Command failed with exit code </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">.</span></span>
<span class="line"><span style="color:#E1E4E8;">Build step </span><span style="color:#9ECBFF;">&#39;Execute shell&#39;</span><span style="color:#E1E4E8;"> marked build as failure</span></span>
<span class="line"><span style="color:#E1E4E8;">Finished: FAILURE</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[error] [</span><span style="color:#005CC5;">31</span><span style="color:#24292E;">m[vite]: Rollup failed to resolve import </span><span style="color:#032F62;">&quot;@babel/runtime/helpers/asyncToGenerator&quot;</span><span style="color:#24292E;"> from </span><span style="color:#032F62;">&quot;node_modules/.pnpm/@antv+g-webgpu@0.7.2/node_modules/@antv/g-webgpu/es/Kernel.js&quot;</span><span style="color:#24292E;">.</span></span>
<span class="line"><span style="color:#24292E;">This is most likely unintended because it can </span><span style="color:#D73A49;">break</span><span style="color:#24292E;"> your application at runtime.</span></span>
<span class="line"><span style="color:#24292E;">If you </span><span style="color:#D73A49;">do</span><span style="color:#24292E;"> want to externalize this module explicitly add it to</span></span>
<span class="line"><span style="color:#032F62;">\`</span><span style="color:#6F42C1;">build.rollupOptions.external</span><span style="color:#032F62;">\`</span><span style="color:#24292E;">[</span><span style="color:#005CC5;">39</span><span style="color:#24292E;">m</span></span>
<span class="line"><span style="color:#24292E;">[error] [</span><span style="color:#005CC5;">31</span><span style="color:#24292E;">merror during build:</span></span>
<span class="line"><span style="color:#24292E;">Error: [vite]: Rollup failed to resolve import </span><span style="color:#032F62;">&quot;@babel/runtime/helpers/asyncToGenerator&quot;</span><span style="color:#24292E;"> from </span><span style="color:#032F62;">&quot;node_modules/.pnpm/@antv+g-webgpu@0.7.2/node_modules/@antv/g-webgpu/es/Kernel.js&quot;</span><span style="color:#24292E;">.</span></span>
<span class="line"><span style="color:#24292E;">This is most likely unintended because it can </span><span style="color:#D73A49;">break</span><span style="color:#24292E;"> your application at runtime.</span></span>
<span class="line"><span style="color:#24292E;">If you </span><span style="color:#D73A49;">do</span><span style="color:#24292E;"> want to externalize this module explicitly add it to</span></span>
<span class="line"><span style="color:#032F62;">\`</span><span style="color:#6F42C1;">build.rollupOptions.external</span><span style="color:#032F62;">\`</span></span>
<span class="line"><span style="color:#24292E;">    at onRollupWarning (file:///data/jenkins/workspace/ever-digitalfactory-develop-app-ppm-e2392d6ad476d483127ce365e5b7bbcd/node_modules/.pnpm/vite@3.2.8_sass@1.70.0+terser@5.27.0/node_modules/vite/dist/node/chunks/dep-f11f7337.js:45909:19)</span></span>
<span class="line"><span style="color:#24292E;">    at onwarn (file:///data/jenkins/workspace/ever-digitalfactory-develop-app-ppm-e2392d6ad476d483127ce365e5b7bbcd/node_modules/.pnpm/vite@3.2.8_sass@1.70.0+terser@5.27.0/node_modules/vite/dist/node/chunks/dep-f11f7337.js:45680:13)</span></span>
<span class="line"><span style="color:#24292E;">    at Object.onwarn (file:///data/jenkins/workspace/ever-digitalfactory-develop-app-ppm-e2392d6ad476d483127ce365e5b7bbcd/node_modules/.pnpm/rollup@2.79.1/node_modules/rollup/dist/es/shared/rollup.js:23263:13)</span></span>
<span class="line"><span style="color:#24292E;">    at ModuleLoader.handleResolveId (file:///data/jenkins/workspace/ever-digitalfactory-develop-app-ppm-e2392d6ad476d483127ce365e5b7bbcd/node_modules/.pnpm/rollup@2.79.1/node_modules/rollup/dist/es/shared/rollup.js:22158:26)</span></span>
<span class="line"><span style="color:#24292E;">    at file:///data/jenkins/workspace/ever-digitalfactory-develop-app-ppm-e2392d6ad476d483127ce365e5b7bbcd/node_modules/.pnpm/rollup@2.79.1/node_modules/rollup/dist/es/shared/rollup.js:22119:26</span></span>
<span class="line"><span style="color:#24292E;">    at async Promise.all (index </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">)[</span><span style="color:#005CC5;">39</span><span style="color:#24292E;">m</span></span>
<span class="line"><span style="color:#24292E;"> ELIFECYCLE  Command failed with exit code </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">.</span></span>
<span class="line"><span style="color:#24292E;">Build step </span><span style="color:#032F62;">&#39;Execute shell&#39;</span><span style="color:#24292E;"> marked build as failure</span></span>
<span class="line"><span style="color:#24292E;">Finished: FAILURE</span></span></code></pre></div><h2 id="产生原因" tabindex="-1">产生原因 <a class="header-anchor" href="#产生原因" aria-label="Permalink to &quot;产生原因&quot;">​</a></h2><p>项目引用直接依赖或深层依赖使用了CommonJs方式导致。</p><p>log中提示的<code>@antv/g-webgpu</code>没有在项目中直接引用，恰好时刚更新没多久的新包 <img src="`+l+`" alt="@antv/g-webgpu"></p><p>Vite内部使用了Rollup进行构建打包，Rollup 默认只处理 ES6 模块，而更新后的<code>@antv/g-webgpu</code>可能使用了CommonJs方式。</p><h2 id="解决步骤" tabindex="-1">解决步骤 <a class="header-anchor" href="#解决步骤" aria-label="Permalink to &quot;解决步骤&quot;">​</a></h2><p>使用Rollup插件处理CommonJS方法的第三方依赖<code>@rollup/plugin-commonjs</code>,项目根目录新建<code>rollup.config.js</code>：</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> commonjs </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;@rollup/plugin-commonjs&#39;</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">default</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// ...其他配置</span></span>
<span class="line"><span style="color:#E1E4E8;">    plugins: [</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// ...其他插件</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">commonjs</span><span style="color:#E1E4E8;">(),</span></span>
<span class="line"><span style="color:#E1E4E8;">    ],</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> commonjs </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;@rollup/plugin-commonjs&#39;</span></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">default</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// ...其他配置</span></span>
<span class="line"><span style="color:#24292E;">    plugins: [</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// ...其他插件</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">commonjs</span><span style="color:#24292E;">(),</span></span>
<span class="line"><span style="color:#24292E;">    ],</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div>`,11),t=[p];function r(c,i,d,E,u,y){return a(),n("div",null,t)}const v=s(o,[["render",r]]);export{b as __pageData,v as default};
